---
import { getTrackInfo } from "@/libs/spotify";

import { Icon } from "astro-icon/components";

const [isNowPlaying, track] = await getTrackInfo();
---

{
  isNowPlaying != null && (
    <>
      <span class="flex flex-col sm:flex-row w-full justify-center items-center space-x-0 sm:space-x-4 space-y-2 sm:space-y-0">
        <span class="flex flex-col justify-center items-center">
          <a href={track.trackUrl} target="_blank">
            <span class="flex flex-col justify-center items-center space-y-1 hover:text-blue-600 transition-colors">
              <p class="flex items-center transition-colors">
                <Icon class="w-4 h-4" name="ri:spotify-fill" />
                <span class="ml-2">
                  {isNowPlaying ? "now playing" : "last played"}
                </span>
              </p>
              <img
                src={track.imageUrl}
                alt="album cover"
                class="object-scale-down h-24 w-24"
              />
            </span>
          </a>
        </span>
        <span class="flex flex-col justify-center">
          <a href={process.env.SPOTIFY_USER_URL} target="_blank">
            <p class="flex justify-center sm:justify-start items-center transition-colors">
              <Icon
                class={
                  isNowPlaying
                    ? "w-4 h-4 text-emerald-500"
                    : "w-4 h-4 text-red-500"
                }
                name={
                  isNowPlaying ? "ri:user-follow-fill" : "ri:user-unfollow-fill"
                }
              />
              {isNowPlaying ? (
                <span class="ml-2 text-emerald-500">yanosea online!</span>
              ) : (
                <span class="ml-2 text-red-500">yanosea offline...</span>
              )}
            </p>
          </a>
          {!isNowPlaying && (
            <p class="flex items-center transition-colors">
              <Icon class="w-4 h-4" name="ph:clock-fill" />
              <span class="ml-2">Played at : {track.playedAt}</span>
            </p>
          )}
          <a href={track.trackUrl} target="_blank">
            <p class="flex items-center transition-colors hover:text-blue-600">
              <Icon class="w-4 h-4" name="ph:music-note-fill" />
              <span class="ml-2">track : {track.trackName}</span>
            </p>
          </a>
          <a href={track.albumUrl} target="_blank">
            <p class="flex items-center transition-colors hover:text-blue-600">
              <Icon class="w-4 h-4" name="ph:disc-fill" />
              <span class="ml-2">album : {track.albumName}</span>
            </p>
          </a>
          <a href={track.artistUrl} target="_blank">
            <p class="flex items-center transition-colors hover:text-blue-600">
              <Icon class="w-4 h-4" name="ph:microphone-stage-fill" />
              <span class="ml-2">artist : {track.artistName}</span>
            </p>
          </a>
        </span>
      </span>
    </>
  )
}
